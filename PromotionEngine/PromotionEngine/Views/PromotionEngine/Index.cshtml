
@{
    ViewData["Title"] = "Promotion Engine";
}


<div class="form-group">
    <h3>Welcome to Promotion Engine</h3>


    <label>Items:</label>
    <select name="item" id="Sku" class="form-control col-2">
    </select>
    <br />

    <button type="button" id="btnAddItemToCart">Add To Cart</button>
    <button type="button" id="btnGetTotal">Total Cart Value</button>
    <button type="button" id="btnClear">Clear Cart</button>

</div>

<div class="form-group row">
    <div class="col-sm-4">
        <ul class="list-group" id="cartItemsId"></ul>
    </div>
    <div class="col-sm-2" id="output">
        <h3>Output:</h3>
    </div>
    <div class="col-sm-4" id="cart">
        <label><b>Cart value : </b></label>
        <span id="totalSum"></span>
        <ul id="finalCartlogic">
        </ul>
    </div>
</div>


<script>

    $(document).ready(function () {
        $('#output').hide();
        $('#cart').hide();
        //to get All sku in dropdown
        $.ajax({
            dataType: 'json',
            type: 'GET',
            url: 'PromotionEngine/GetSku',
            success: function (data) {
                let option = '';
                for (var i = 0; i < data.length; i++) {
                    option += '<option value="' + data[i] + '">' + data[i] + '</option>';
                }
                $('#Sku').append(option);
            }

        })
    })

    $("#btnClear").click(function () {
        $("#cartItemsId").empty();
        $('#finalCartlogic').empty();
        $("#totalSum").empty();
        $('#output').hide();
        $('#cart').hide();
    });

    //Adding items to cart
    $("#btnAddItemToCart").click(function () {
        var value = $("#Sku").val();
        $("#cartItemsId").append('<li>' + value + '</li>');
    })

    $("#btnGetTotal").click(function () {
        var arr = [];
        //loop to get all added items
        $("#cartItemsId li").each(function () { arr.push($(this).text()) });
        if (arr.length > 0) {
            $.ajax({
                dataType: 'json',
                type: 'POST',
                async: true,
                data: { cartArray: arr },
                url: "PromotionEngine/GetTotalCartValue",
                success: function (data, status) {
                    $('#output').show();
                    $('#cart').show();
                    $("#totalSum").html(data.total);
                    let text = '';
                    for (i = 0; i < data.cartitems.length; i++) {
                        text += '<li>' + data.cartitems[i] + '</li>'
                    }
                    $('#finalCartlogic').append(text);
                },
                error: function (xhr, status, error) { // error callback
                    var err = xhr.responseText;
                    console.log(err);
                }
            });
        } else {
            alert("please add item to cart");
        }
    });
</script>

